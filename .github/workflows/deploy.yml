name: Build and Deploy

on:
  push:
    branches: [master]

jobs:
  build:
    runs-on: ubuntu-latest
     steps:
      - uses: actions/checkout@v2
      with:
      node-version: 14

    # Install deps, run tests and run build
    - name: npm install
      run: |
        npm install
    - name: npm test
      run: |
        npm test 
    - name: npm export
      run: |
        npm run export
        env:
            CI: true

    # Copying files and artifacts via SSH
    - name: Copying files to server
      uses: appleboy/scp-action@master
      with:
        HOST: ${{ secrets.SSH_HOST }}
        USERNAME: ${{ secrets.SSH_USERNAME }}
        PORT: 22
        KEY: ${{ secrets.SSH_KEY }}
        FOLDER: out
        target: "${{ secrets.REMOTE_DIR }}"